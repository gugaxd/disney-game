// ==================== Dados de exemplo ====================
const challenges = [
  {
    type: 'audio',
    url: 'assets/audio/do-balacobaco.mp3',
    answer: 'Hercules',
    info: 'Hércules é o melhor filme da Disney',
  },
  {
    type: 'image',
    url: 'assets/images/hades.png',
    answer: 'Hades',
    info: 'Hades é um vilão do filme Hércules',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Hercules',
    info: 'Hércules é o melhor filme da Disney',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  },
  {
    type: 'image',
    url: 'assets/images/hercules.jpg',
    answer: 'Mickey Mouse',
    info: 'Mickey Mouse foi criado em 1928 por Walt Disney e Ub Iwerks.',
  }
];

const maxAttempts = 6;
const blurLevels = [20, 15, 10, 6, 3, 0];
const snippetDurations = [3, 6, 9, 12, 15, null]; // segundos

// ==================== Estado e LocalStorage ====================
function getTodayKey() {
  return new Date().toISOString().slice(0, 10);
}
function loadState() {
  const key = getTodayKey();
  const saved = JSON.parse(localStorage.getItem('disneyGameState') || '{}');
  if (saved.date === key) return saved;
  return { date: key, attempts: 0, solved: false };
}
function saveState(state) {
  localStorage.setItem('disneyGameState', JSON.stringify(state));
}

let state = loadState();
const idx = new Date().getDate() % challenges.length;
const todayChallenge = challenges[idx];

// ==================== Elementos ====================
const playScreen   = document.getElementById('play-screen');
const gameScreen   = document.getElementById('game-screen');
const startBtn     = document.getElementById('start-btn');
const imgEl        = document.getElementById('challenge-image');
const audioEl      = document.getElementById('challenge-audio');
const form         = document.getElementById('guess-form');
const input        = document.getElementById('guess-input');
const suggestions  = document.getElementById('suggestions');
const feedback     = document.getElementById('feedback');
const extraInfo    = document.getElementById('extra-info');
const shareBtn     = document.getElementById('share-btn');

// ==================== Inicialização ====================
function initSuggestions() {
  challenges.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c.answer;
    suggestions.appendChild(opt);
  });
}

function setupChallenge() {
  if (todayChallenge.type === 'image') {
    imgEl.src = todayChallenge.url;
    imgEl.style.display = 'block';
    imgEl.style.filter = `blur(${blurLevels[state.attempts]}px)`;
  } else {
    audioEl.src = todayChallenge.url;
    audioEl.style.display = 'block';
  }
}

function playSnippet() {
  if (todayChallenge.type !== 'audio') return;
  audioEl.currentTime = 0;
  audioEl.play();
  const dur = snippetDurations[state.attempts];
  if (dur) setTimeout(() => audioEl.pause(), dur * 1000);
}

function endGame(win) {
  input.disabled = true;
  document.getElementById('submit-btn').disabled = true;
  shareBtn.hidden = false;
  if (!win) {
    feedback.textContent = `Você não acertou. A resposta era: ${todayChallenge.answer}`;
    feedback.style.color = 'red';
    extraInfo.style.display = 'block';
    extraInfo.textContent = todayChallenge.info;
  }
}

// ==================== Eventos ====================
startBtn.addEventListener('click', () => {
  playScreen.hidden = true;
  gameScreen.hidden = false;
  initSuggestions();
  setupChallenge();
  if (state.solved || state.attempts >= maxAttempts) {
    endGame(state.solved);
  } else {
    if (todayChallenge.type === 'audio') playSnippet();
  }
});

form.addEventListener('submit', e => {
  e.preventDefault();
  const guess = input.value.trim();
  if (!guess) return;
  if (guess.toLowerCase() === todayChallenge.answer.toLowerCase()) {
    feedback.textContent = `Correto! Você acertou em ${state.attempts + 1} tentativas.`;
    feedback.style.color = 'green';
    extraInfo.style.display = 'block';
    extraInfo.textContent = todayChallenge.info;
    state.solved = true;
    saveState(state);
    endGame(true);
  } else {
    state.attempts++;
    saveState(state);
    if (state.attempts >= maxAttempts) {
      endGame(false);
    } else {
      feedback.textContent = `Errado! Tentativa ${state.attempts} de ${maxAttempts}. Tente novamente.`;
      feedback.style.color = 'orange';
      if (todayChallenge.type === 'image') {
        imgEl.style.filter = `blur(${blurLevels[state.attempts]}px)`;
      } else {
        playSnippet();
      }
    }
  }
  input.value = '';
});

shareBtn.addEventListener('click', () => {
  let text;
  if (state.solved) text = `Disney Guessing Game: acertei em ${state.attempts + 1} tentativas!`;
  else text = `Disney Guessing Game: não acertei. Resposta: ${todayChallenge.answer}.`;
  if (navigator.share) {
    navigator.share({ text });
  } else {
    navigator.clipboard.writeText(text)
      .then(() => alert('Resultado copiado para a área de transferência!'))
      .catch(() => alert(text));
  }
});
